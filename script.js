// This file is auto-generated from export_import_data.csv. Do not edit directly.
const tradeData = [
  {
    "country": "Afghanistan",
    "exports": 11.446788,
    "imports": 22.588359
  },
  {
    "country": "Albania",
    "exports": 141.727893,
    "imports": 128.280409
  },
  {
    "country": "Algeria",
    "exports": 1014.504109,
    "imports": 2461.611142
  },
  {
    "country": "Angola",
    "exports": 682.3528689999999,
    "imports": 1869.239166
  },
  {
    "country": "Antigua and Barbuda",
    "exports": 573.765998,
    "imports": 23.75155
  },
  {
    "country": "Argentina",
    "exports": 9170.997286,
    "imports": 7092.161168999999
  },
  {
    "country": "Armenia",
    "exports": 160.78363,
    "imports": 121.583116
  },
  {
    "country": "Aruba",
    "exports": 725.5394950000001,
    "imports": 10.704668
  },
  {
    "country": "Australia",
    "exports": 34593.34853700001,
    "imports": 16685.50984
  },
  {
    "country": "Azerbaijan",
    "exports": 255.07449,
    "imports": 157.776472
  },
  {
    "country": "Bahamas",
    "exports": 5639.742401,
    "imports": 1792.373019
  },
  {
    "country": "Bahrain",
    "exports": 1646.230202,
    "imports": 1204.340922
  },
  {
    "country": "Bangladesh",
    "exports": 2213.964142,
    "imports": 8365.766327
  },
  {
    "country": "Barbados",
    "exports": 772.603153,
    "imports": 48.564639
  },
  {
    "country": "Belarus",
    "exports": 10.599133,
    "imports": 20.048973
  },
  {
    "country": "Belize",
    "exports": 590.4483550000001,
    "imports": 81.128498
  },
  {
    "country": "Benin",
    "exports": 216.446069,
    "imports": 48.62340400000001
  },
  {
    "country": "Bermuda",
    "exports": 540.382525,
    "imports": 23.328268
  },
  {
    "country": "Bhutan",
    "exports": 3.427734000000001,
    "imports": 3.281048
  },
  {
    "country": "Bolivia",
    "exports": 401.036421,
    "imports": 504.146695
  },
  {
    "country": "Bosnia and Herzegovina",
    "exports": 52.98845600000001,
    "imports": 179.089584
  },
  {
    "country": "Botswana",
    "exports": 104.327456,
    "imports": 405.1236740000001
  },
  {
    "country": "Brazil",
    "exports": 49666.976323,
    "imports": 42316.323621
  },
  {
    "country": "Brunei",
    "exports": 127.213271,
    "imports": 238.849306
  },
  {
    "country": "Burkina Faso",
    "exports": 54.359393,
    "imports": 4.520665999999999
  },
  {
    "country": "Burma",
    "exports": 77.15222200000001,
    "imports": 656.460945
  },
  {
    "country": "Burundi",
    "exports": 6.61399,
    "imports": 3.736683999999999
  },
  {
    "country": "Cabo Verde",
    "exports": 12.246976,
    "imports": 4.482999
  },
  {
    "country": "Cambodia",
    "exports": 321.629583,
    "imports": 12661.806815
  },
  {
    "country": "Cameroon",
    "exports": 193.064344,
    "imports": 248.80528
  },
  {
    "country": "Canada",
    "exports": 349359.939946,
    "imports": 412695.719877
  },
  {
    "country": "Cayman Islands",
    "exports": 1286.490024,
    "imports": 49.39955
  },
  {
    "country": "Central African Republic",
    "exports": 35.070359,
    "imports": 1.422027
  },
  {
    "country": "Chad",
    "exports": 59.93985499999999,
    "imports": 80.81403799999998
  },
  {
    "country": "Chile",
    "exports": 18167.793397,
    "imports": 16469.479956
  },
  {
    "country": "China",
    "exports": 143545.739507,
    "imports": 438947.386145
  },
  {
    "country": "Colombia",
    "exports": 19037.613407,
    "imports": 17690.348963
  },
  {
    "country": "Comoros",
    "exports": 4.738928,
    "imports": 1.848391
  },
  {
    "country": "Congo (Brazzaville)",
    "exports": 237.138527,
    "imports": 40.200821
  },
  {
    "country": "Congo (Kinshasa)",
    "exports": 253.285367,
    "imports": 323.100139
  },
  {
    "country": "Cook Islands",
    "exports": 6.861174999999999,
    "imports": 0.8921189999999999
  },
  {
    "country": "Costa Rica",
    "exports": 9676.788152,
    "imports": 11634.905331
  },
  {
    "country": "Cote d'Ivoire",
    "exports": 596.568616,
    "imports": 1014.676411
  },
  {
    "country": "Curacao",
    "exports": 823.501266,
    "imports": 31.935945
  },
  {
    "country": "Djibouti",
    "exports": 144.982858,
    "imports": 40.11125
  },
  {
    "country": "Dominica",
    "exports": 58.79899,
    "imports": 2.306195
  },
  {
    "country": "Dominican Republic",
    "exports": 13081.661072,
    "imports": 7505.430837999999
  },
  {
    "country": "East Timor",
    "exports": 19.021945,
    "imports": 5.912675999999999
  },
  {
    "country": "Ecuador",
    "exports": 7531.653753000001,
    "imports": 8524.306263
  },
  {
    "country": "Egypt",
    "exports": 6092.022475,
    "imports": 2546.000141
  },
  {
    "country": "El Salvador",
    "exports": 4556.353458000001,
    "imports": 2311.212791
  },
  {
    "country": "Equatorial Guinea",
    "exports": 95.37969099999998,
    "imports": 127.640788
  },
  {
    "country": "Eritrea",
    "exports": 37.475441,
    "imports": 0.8529180000000001
  },
  {
    "country": "Eswatini",
    "exports": 46.113517,
    "imports": 22.588609
  },
  {
    "country": "Ethiopia",
    "exports": 1017.706562,
    "imports": 465.844335
  },
  {
    "country": "European Union",
    "exports": 370189.230351,
    "imports": 605760.393292
  },
  {
    "country": "Fiji",
    "exports": 94.67957100000001,
    "imports": 259.272473
  },
  {
    "country": "French Polynesia",
    "exports": 145.19757,
    "imports": 40.42327
  },
  {
    "country": "Gabon",
    "exports": 171.065105,
    "imports": 171.666854
  },
  {
    "country": "Gambia",
    "exports": 80.563522,
    "imports": 1.969897
  },
  {
    "country": "Georgia",
    "exports": 1736.461692,
    "imports": 165.414171
  },
  {
    "country": "Ghana",
    "exports": 967.304543,
    "imports": 1171.728486
  },
  {
    "country": "Greenland",
    "exports": 48.420782,
    "imports": 32.585481
  },
  {
    "country": "Grenada",
    "exports": 165.335817,
    "imports": 14.074818
  },
  {
    "country": "Guatemala",
    "exports": 9714.801951,
    "imports": 5019.892412
  },
  {
    "country": "Guinea",
    "exports": 138.336186,
    "imports": 6.179835
  },
  {
    "country": "Guinea-Bissau",
    "exports": 3.394912000000001,
    "imports": 0.122848
  },
  {
    "country": "Guyana",
    "exports": 1314.93053,
    "imports": 5375.48866
  },
  {
    "country": "Haiti",
    "exports": 1214.423999,
    "imports": 616.7707849999999
  },
  {
    "country": "Honduras",
    "exports": 7057.473677,
    "imports": 5532.561721
  },
  {
    "country": "Hong Kong",
    "exports": 27886.366138,
    "imports": 5972.900454000001
  },
  {
    "country": "Iceland",
    "exports": 985.844921,
    "imports": 1072.626837
  },
  {
    "country": "India",
    "exports": 41752.66796800001,
    "imports": 87416.448578
  },
  {
    "country": "Indonesia",
    "exports": 10202.09572,
    "imports": 28084.737884
  },
  {
    "country": "Iran",
    "exports": 90.84743,
    "imports": 6.218490999999999
  },
  {
    "country": "Iraq",
    "exports": 1660.554212,
    "imports": 7422.275380999999
  },
  {
    "country": "Israel",
    "exports": 14792.03496,
    "imports": 22217.484849
  },
  {
    "country": "Jamaica",
    "exports": 2644.127532,
    "imports": 361.372579
  },
  {
    "country": "Japan",
    "exports": 79740.84554599998,
    "imports": 148208.566623
  },
  {
    "country": "Jordan",
    "exports": 2030.78495,
    "imports": 3364.877293
  },
  {
    "country": "Kazakhstan",
    "exports": 1077.097171,
    "imports": 2330.74942
  },
  {
    "country": "Kenya",
    "exports": 782.524079,
    "imports": 737.305128
  },
  {
    "country": "Kiribati",
    "exports": 4.220009000000001,
    "imports": 0.8081619999999999
  },
  {
    "country": "South Korea",
    "exports": 65541.79041799999,
    "imports": 131549.18712
  },
  {
    "country": "Kuwait",
    "exports": 2411.831329,
    "imports": 1643.60575
  },
  {
    "country": "Kyrgyzstan",
    "exports": 133.144912,
    "imports": 16.66837
  },
  {
    "country": "Laos",
    "exports": 40.385293,
    "imports": 803.320155
  },
  {
    "country": "Lebanon",
    "exports": 541.421719,
    "imports": 257.571987
  },
  {
    "country": "Lesotho",
    "exports": 2.794513,
    "imports": 237.257685
  },
  {
    "country": "Liberia",
    "exports": 220.400195,
    "imports": 72.529569
  },
  {
    "country": "Libya",
    "exports": 567.220437,
    "imports": 1465.562558
  },
  {
    "country": "Macau",
    "exports": 275.141629,
    "imports": 108.792661
  },
  {
    "country": "North Macedonia",
    "exports": 60.635165,
    "imports": 173.710793
  },
  {
    "country": "Madagascar",
    "exports": 53.407211,
    "imports": 733.215493
  },
  {
    "country": "Malawi",
    "exports": 26.940731,
    "imports": 41.05461
  },
  {
    "country": "Malaysia",
    "exports": 27704.750827,
    "imports": 52534.847955
  },
  {
    "country": "Maldives",
    "exports": 92.61202399999999,
    "imports": 4.765289
  },
  {
    "country": "Mali",
    "exports": 51.49678900000001,
    "imports": 5.500278000000001
  },
  {
    "country": "Marshall Islands",
    "exports": 127.426248,
    "imports": 20.448963
  },
  {
    "country": "Mauritania",
    "exports": 139.755555,
    "imports": 2.854898
  },
  {
    "country": "Mauritius",
    "exports": 47.99103999999999,
    "imports": 234.519911
  },
  {
    "country": "Mexico",
    "exports": 334041.359045,
    "imports": 505850.598583
  },
  {
    "country": "Micronesia",
    "exports": 50.48958199999999,
    "imports": 2.44009
  },
  {
    "country": "Moldova",
    "exports": 53.629683,
    "imports": 136.495167
  },
  {
    "country": "Mongolia",
    "exports": 396.615463,
    "imports": 26.97744
  },
  {
    "country": "Montenegro",
    "exports": 27.681345,
    "imports": 15.382306
  },
  {
    "country": "Morocco",
    "exports": 5268.646115,
    "imports": 1904.884441
  },
  {
    "country": "Mozambique",
    "exports": 149.698447,
    "imports": 216.070589
  },
  {
    "country": "Namibia",
    "exports": 160.506498,
    "imports": 275.2250979999999
  },
  {
    "country": "Nepal",
    "exports": 120.890203,
    "imports": 120.461589
  },
  {
    "country": "New Caledonia",
    "exports": 29.39451799999999,
    "imports": 33.844904
  },
  {
    "country": "New Zealand",
    "exports": 4499.423962,
    "imports": 5617.042562
  },
  {
    "country": "Nicaragua",
    "exports": 2940.985161000001,
    "imports": 4622.325539
  },
  {
    "country": "Niger",
    "exports": 43.252222,
    "imports": 8.306694
  },
  {
    "country": "Nigeria",
    "exports": 4174.298267,
    "imports": 5699.175958999999
  },
  {
    "country": "Norway",
    "exports": 4592.039618000001,
    "imports": 6583.334169999999
  },
  {
    "country": "Oman",
    "exports": 1954.270075,
    "imports": 1319.991529
  },
  {
    "country": "Pakistan",
    "exports": 2135.147106,
    "imports": 5123.65616
  },
  {
    "country": "Palau",
    "exports": 20.993953,
    "imports": 2.234213
  },
  {
    "country": "Panama",
    "exports": 10702.134058,
    "imports": 555.820472
  },
  {
    "country": "Papua New Guinea",
    "exports": 67.20022,
    "imports": 79.150698
  },
  {
    "country": "Paraguay",
    "exports": 3158.414426,
    "imports": 356.152957
  },
  {
    "country": "Peru",
    "exports": 11223.803301,
    "imports": 9363.192761000002
  },
  {
    "country": "Philippines",
    "exports": 9297.313128999998,
    "imports": 14177.628116
  },
  {
    "country": "Qatar",
    "exports": 3804.248139,
    "imports": 1834.185727
  },
  {
    "country": "Republic of Yemen",
    "exports": 134.099622,
    "imports": 8.915257999999998
  },
  {
    "country": "Rwanda",
    "exports": 44.75779700000001,
    "imports": 30.238416
  },
  {
    "country": "Saudi Arabia",
    "exports": 13177.010088,
    "imports": 12733.725159
  },
  {
    "country": "Senegal",
    "exports": 350.866605,
    "imports": 235.125168
  },
  {
    "country": "Serbia",
    "exports": 209.85911,
    "imports": 814.350544
  },
  {
    "country": "Seychelles",
    "exports": 16.53426,
    "imports": 7.150942000000001
  },
  {
    "country": "Sierra Leone",
    "exports": 119.859059,
    "imports": 28.74785
  },
  {
    "country": "Singapore",
    "exports": 46032.64597200001,
    "imports": 43203.72290300001
  },
  {
    "country": "Sint Maarten",
    "exports": 753.934338,
    "imports": 101.535218
  },
  {
    "country": "Solomon Islands",
    "exports": 13.147232,
    "imports": 1.345899
  },
  {
    "country": "Somalia",
    "exports": 49.12370600000001,
    "imports": 2.482732
  },
  {
    "country": "South Africa",
    "exports": 5818.998932,
    "imports": 14655.786588
  },
  {
    "country": "South Sudan",
    "exports": 59.276702,
    "imports": 0.805202
  },
  {
    "country": "Sri Lanka",
    "exports": 368.214575,
    "imports": 3015.585462
  },
  {
    "country": "St Kitts and Nevis",
    "exports": 160.188109,
    "imports": 19.629242
  },
  {
    "country": "St Lucia",
    "exports": 1043.5999,
    "imports": 6.955919999999999
  },
  {
    "country": "St Pierre and Miquelon",
    "exports": 0.051169,
    "imports": 3.435723
  },
  {
    "country": "St Vincent and the Grenadines",
    "exports": 143.215089,
    "imports": 8.26388
  },
  {
    "country": "Sudan",
    "exports": 56.61092900000001,
    "imports": 13.133891
  },
  {
    "country": "Suriname",
    "exports": 383.542932,
    "imports": 90.91341
  },
  {
    "country": "Switzerland",
    "exports": 24961.986918,
    "imports": 63425.318602
  },
  {
    "country": "Syria",
    "exports": 2.020826,
    "imports": 10.651468
  },
  {
    "country": "Taiwan",
    "exports": 42336.861419,
    "imports": 116264.026887
  },
  {
    "country": "Tajikistan",
    "exports": 56.83741,
    "imports": 4.633938
  },
  {
    "country": "Tanzania",
    "exports": 573.3800410000001,
    "imports": 204.714855
  },
  {
    "country": "Thailand",
    "exports": 17719.249485,
    "imports": 63328.18022200001
  },
  {
    "country": "Togo",
    "exports": 283.59244,
    "imports": 89.99636499999998
  },
  {
    "country": "Tonga",
    "exports": 19.909723,
    "imports": 2.845246
  },
  {
    "country": "Trinidad and Tobago",
    "exports": 2939.684738,
    "imports": 3325.877971
  },
  {
    "country": "Tunisia",
    "exports": 503.588215,
    "imports": 1123.215612
  },
  {
    "country": "Turkey",
    "exports": 15292.979687,
    "imports": 16745.664057
  },
  {
    "country": "Turkmenistan",
    "exports": 82.234419,
    "imports": 14.590585
  },
  {
    "country": "Turks and Caicos Islands",
    "exports": 713.57661,
    "imports": 10.983629
  },
  {
    "country": "Uganda",
    "exports": 106.29285,
    "imports": 132.618139
  },
  {
    "country": "Ukraine",
    "exports": 1683.510839,
    "imports": 1186.498293
  },
  {
    "country": "United Arab Emirates",
    "exports": 26969.308978,
    "imports": 7474.432624
  },
  {
    "country": "United Kingdom",
    "exports": 79941.342753,
    "imports": 68084.46833199999
  },
  {
    "country": "Uruguay",
    "exports": 1649.000113,
    "imports": 1228.834152
  },
  {
    "country": "Uzbekistan",
    "exports": 380.795484,
    "imports": 42.43758500000001
  },
  {
    "country": "Vanuatu",
    "exports": 7.601059,
    "imports": 13.667021
  },
  {
    "country": "Venezuela",
    "exports": 4232.021935,
    "imports": 5987.862776999999
  },
  {
    "country": "Vietnam",
    "exports": 13098.155121,
    "imports": 136561.155809
  },
  {
    "country": "Wallis and Futuna",
    "exports": 0.049438,
    "imports": 0.039214
  },
  {
    "country": "Zambia",
    "exports": 113.762941,
    "imports": 169.112021
  },
  {
    "country": "Zimbabwe",
    "exports": 43.782746,
    "imports": 67.833118
  }
];

// Default parameters
const DEFAULT_EPSILON = 4;
const DEFAULT_PHI = 0.25;

// DOM elements
const epsilonInput = document.getElementById('epsilon');
const phiInput = document.getElementById('phi');
const resetButton = document.getElementById('reset');
const exportButton = document.getElementById('export');
const resultsTable = document.getElementById('results');
const sortButtons = document.querySelectorAll('.sort-button');

// Sort state
let currentSortColumn = 'exports';
let currentSortDirection = 'desc';

// Calculate tariff rate for a single country
function calculateTariffRate(exports, imports, epsilon, phi) {
    if (imports === 0) return 0;
    return -((exports - imports) / (epsilon * phi * imports)) * 100;
}

// Calculate US Tariff
function calculateUSTariff(deltaT) {
    return Math.ceil(Math.max(deltaT/2, 10));
}

// Sort data
function sortData(data, column, direction) {
    return [...data].sort((a, b) => {
        let valueA, valueB;

        if (column === 'tariff' || column === 'usTariff') {
            const epsilon = parseFloat(epsilonInput.value);
            const phi = parseFloat(phiInput.value);
            const tariffA = calculateTariffRate(a.exports, a.imports, epsilon, phi);
            const tariffB = calculateTariffRate(b.exports, b.imports, epsilon, phi);

            if (column === 'usTariff') {
                valueA = calculateUSTariff(tariffA);
                valueB = calculateUSTariff(tariffB);
            } else {
                valueA = tariffA;
                valueB = tariffB;
            }
        } else {
            valueA = a[column];
            valueB = b[column];
        }

        if (direction === 'asc') {
            return valueA > valueB ? 1 : -1;
        } else {
            return valueA < valueB ? 1 : -1;
        }
    });
}

// Update sort buttons
function updateSortButtons() {
    sortButtons.forEach(button => {
        const column = button.dataset.column;
        if (column === currentSortColumn) {
            button.textContent = currentSortDirection === 'asc' ? '↑' : '↓';
        } else {
            button.textContent = '↕';
        }
    });
}

// Format number with commas and round to integer
function formatNumber(number) {
    return Math.round(number).toLocaleString('en-US');
}

// Update the results table
function updateResults() {
    const epsilon = parseFloat(epsilonInput.value);
    const phi = parseFloat(phiInput.value);

    resultsTable.innerHTML = '';

    const sortedData = sortData(tradeData, currentSortColumn, currentSortDirection);

    sortedData.forEach(data => {
        const tariffRate = calculateTariffRate(data.exports, data.imports, epsilon, phi);
        const usTariff = calculateUSTariff(tariffRate);

        const row = document.createElement('tr');
        row.innerHTML = `
            <td>${data.country}</td>
            <td>${formatNumber(data.exports)}</td>
            <td>${formatNumber(data.imports)}</td>
            <td>${Math.round(tariffRate)}%</td>
            <td class="us-tariff">${Math.round(usTariff)}%</td>
        `;
        resultsTable.appendChild(row);
    });

    updateSortButtons();
}

// Handle sort button click
function handleSort(column) {
    if (column === currentSortColumn) {
        currentSortDirection = currentSortDirection === 'asc' ? 'desc' : 'asc';
    } else {
        currentSortColumn = column;
        currentSortDirection = 'asc';
    }
    updateResults();
}

// Reset parameters to defaults
function resetParameters() {
    epsilonInput.value = DEFAULT_EPSILON;
    phiInput.value = DEFAULT_PHI;
    updateResults();
}

// Export results to CSV
function exportToCSV() {
    const epsilon = parseFloat(epsilonInput.value);
    const phi = parseFloat(phiInput.value);

    let csvContent = "Country,Exports (USD millions),Imports (USD millions),Tariff Charged to US (%),US Reciprocal Tariff (%)\n";

    const sortedData = sortData(tradeData, currentSortColumn, currentSortDirection);

    sortedData.forEach(data => {
        const tariffRate = calculateTariffRate(data.exports, data.imports, epsilon, phi);
        const usTariff = calculateUSTariff(tariffRate);
        csvContent += `"${data.country.replace(/"/g, '""')}",${data.exports},${data.imports},${tariffRate},${usTariff}\n`;
    });

    const blob = new Blob([csvContent], { type: 'text/csv;charset=utf-8;' });
    const link = document.createElement('a');
    const url = URL.createObjectURL(blob);

    // Format the filename with epsilon and phi values
    const filename = `tariff_rates_epsilon_${epsilon.toFixed(1)}_phi_${phi.toFixed(2)}.csv`;

    link.setAttribute('href', url);
    link.setAttribute('download', filename);
    link.style.visibility = 'hidden';

    document.body.appendChild(link);
    link.click();
    document.body.removeChild(link);
}

// Event listeners
epsilonInput.addEventListener('input', updateResults);
phiInput.addEventListener('input', updateResults);
resetButton.addEventListener('click', resetParameters);
exportButton.addEventListener('click', exportToCSV);
sortButtons.forEach(button => {
    button.addEventListener('click', () => handleSort(button.dataset.column));
});

// Set initial values and initialize the table
epsilonInput.value = DEFAULT_EPSILON;
phiInput.value = DEFAULT_PHI;
updateResults();
